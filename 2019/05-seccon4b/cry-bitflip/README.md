# SECCON Beginners CTF 2019 "Bit Flip" [Crypto]

## 問題
平文を1ビットランダムで反転させる能力を手に入れた！

File: bitflip.py
Server: nc 133.242.17.175 31337


## 解法

平文の下位1/4のうち1ビットが反転しているので逆に上位3/4は共通

`C1 ≡ M1**3  mod N`
`C2 ≡ M2**3  mod N`

とすると、`M2 = M1 + (2**r1 - 2**r2) (0 <= r1, r2 <= FLAG.bit_length()//4)`と書ける。以降 `b = (2**r1 - 2**r2)` とする。


M1,M2の関係からRelated Message Attackができて、以下の式が導ける。
(参考: [Coppersmith 相关攻击 Related Message Attack](https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_coppersmith_attack/#related-message-attack))

`M2 ≡ b * (C1 + 2*C2-(b**3)) * (C1 - C2 + 2*(b**3))**(-1)  (mod N)`

r1, r2は[0,500]×[0,500]で総当たりした。

以上の計算をPythonで書いて、しばらく走らせるとフラグが得られた。

```python
from ctflib import *

c1 = 46784677132657507735603056946312776029263978814045601853822232007096429212531659998896562508436807234075810058222002759388360319273434745540963707473615112390207684781456789181388642835543204944680349094948995489212382783555800619433678958931922473037143485847364007406750555943456505850902163867806951686667
c2 = 67426776033209512618254549328058040429529560513542811921975014103792836920810582401157103135945681944434818958040517148792216236029694147640607250136769627508288794605089381895870328600898964914727760320634811012318469455967338106845118351257971175601392757441296874337159474723864033996800642916448027645393

n = 82212154608576254900096226483113810717974464677637469172151624370076874445177909757467220517368961706061745548693538272183076941444005809369433342423449908965735182462388415108238954782902658438063972198394192220357503336925109727386083951661191494159560430569334665763264352163167121773914831172831824145331

e = 3

for i in range(500):
    for j in range(500):
        if i == j:
            continue
        b = 2**i-2**j
        A = (c1+2*c2-pow(b, 3, n)%n)%n
        B = ((c1-c2)%n+2*pow(b, 3, n)%n)%n
        m2 = b*A%n*inv(B, n)%n
        if pow(m2, e, n) == c2:
            print(its(m2, True))
            exit(0)

```


Flag: `ctf4b{b1tfl1pp1ng_1s_r3lated_m3ss4ge}`
