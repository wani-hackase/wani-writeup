
# InterKosenCTF writeup

## E_S_P [526pts, 9 solved]

### 問題
ESP stands for Erai-Sugoi-Power.


### 解法
平文 m の一部以外が分かっている状態でその暗号文 c と e, N が与えられています。Stereotyped message attackができそうな感じです。
まず平文のうち未知の部分を`\x00`に文字数を維持したまま置換します。つまり
```
Yukko the ESPer: My amazing ESP can help you to get the flag! -----> KosenCTF{\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00}
```
とします。
次にこれを数値に変換したものを m として、 `(m+x)^e - c ≡ 0 mod n` となる x を見つければ、x は未知だった平文と一致するはずです。


```Python
n = 11854673881335985163635072085250462726008700043680492953159905880499045049107244300920837378010293967634187346804588819510452454716310449345364124188546434429828696164683059829613371961906369413632824692460386596396440796094037982036847106649198539914928384344336740248673132551761630930934635177708846275801812766262866211038764067901005598991645254669383536667044207899696798812651232711727007656913524974796752223388636251060509176811628992340395409667867485276506854748446486284884567941298744325375140225629065871881284670017042580911891049944582878712176067643299536863795670582466013430445062571854275812914317
c = 4463634440284027456262787412050107955746015405738173339169842084094411947848024686618605435207920428398544523395749856128886621999609050969517923590260498735658605434612437570340238503179473934990935761387562516430309061482070214173153260521746487974982738771243619694317033056927553253615957773428298050465636465111581387005937843088303377810901324355859871291148445415087062981636966504953157489531400811741347386262410364012023870718810153108997879632008454853198551879739602978644245278315624539189505388294856981934616914835545783613517326663771942178964492093094767168721842335827464550361019195804098479315147
e = 5


# Yukko the ESPer: My amazing ESP can help you to get the flag! -----> KosenCTF{\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00}
m = 42983198277764796429769849778560768556634168265102988738267040585263257346275308818714371333496991474059525021258051487213763741199340195311836730211991606494242875122658745448181510008423346774607067116707916143495126355724888827452167127505534385427098632317


P.<x> = PolynomialRing(Zmod(n))
f = (m+x)^e-c
flag = m+f.small_roots(epsilon=1/30)[0]
print(flag.to_bytes((flag.bit_length()+7)//8, byteorder='big'))
```

Flag: `KosenCTF{H0R1_Yukk0_1s_th3_ESP3r_QUEEN}`


参考:  <a href="https://gsdt.github.io/blog/2018/07/20/stereotyped-message-attack/">RSA Attack: Stereotyped message attack</a>
